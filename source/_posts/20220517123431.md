---
title: 博客改造计划
author: 归梦
categories: [笔记本]
date: 2022-05-17 12:34:31
updated: 2022-05-17 12:34:31
index_img: https://i0.hdslb.com/bfs/album/abb2f330fb6128fd320ea654f9d0b8c316a5dabe.png@600w.webp
description: 记录一次博客主题魔改过程
---

我的博客最初使用的是 Butterlfy 主题，当时通过一系列魔改用上了全屏背景，我最近在想能不能让 Fluid 主题也用上全屏背景，在主题 Github 仓库的一条 issue 里面作者明确表示不建议使用全屏背景，原因是手机端浏览效果可能不太理想，那我只能尝试自己魔改咯。

首先需要把原来的 Banner 头图和 Mask 蒙版清除掉，在自定义 css 中加入如下内容即可：

```css
#banner {
    background-image: none !important;
}

#banner .mask {
    background-color: transparent !important;
}
```

然后需要通过 Hexo 注入器在 `body` 标签开头注入全屏背景，至于如何注入可以查看[进阶用法](https://hexo.fluid-dev.com/docs/advance/)，注入代码如下：

```javascript
hexo.extend.injector.register("body_begin", `<div id="web-bg-light"></div><div id="web-bg-dark"></div>`);
```

这里我注入了两个背景，分别是日间模式和夜间模式的背景，日间模式默认显示，切换背景只需要设置夜间模式背景的透明度就可以了，非常方便（我最初只设置一张背景的时候切换 background-image url 会闪屏，就离谱）。

接下来需要设置两个背景的 css 样式，自定义样式代码如下：

```css
/* 日间模式 */
#web-bg-light {
    position: fixed;
    z-index: -999;
    width: 100%;
    height: 100%;
    background-attachment: fixed;
    background-position: center;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    background-size: cover;
    background-repeat: no-repeat;
    background-image: url();
}

/* 夜间模式 */
#web-bg-dark {
    position: fixed;
    z-index: -888;
    width: 100%;
    height: 100%;
    background-attachment: fixed;
    background-position: center;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    background-size: cover;
    background-repeat: no-repeat;
    background-image: url();
    /* 透明度渐变 */
    transition: opacity 0.3s ease-in; 
    -moz-transition: opacity 0.3s ease-in;
    -webkit-transition: opacity 0.3s ease-in;
}
```

由于要做到点击主题切换按钮能够实现背景变化，所以需要给夜间模式添加两个 class 来控制透明度，日间模式全透明，夜间模式不透明。

```css
/* 透明度控制 */
.bg-dark {
    opacity: 1;
}

.bg-light {
    opacity: 0;
}
```

接下来需要修改按钮的点击事件，在相应模式添加对应的 class 即可，主题文件夹中的 `color-schema.js` 文件就是用来控制日间模式和夜间模式主题属性的，在相应的地方添加代码即可：

```javascript
var webBackground = '#web-bg-dark'; // 背景

// 获取类名函数
function getBackgroundClass(schema) {
    return 'bg-' + schema;
}

// 类名
var bg = getBackgroundClass('dark');
if (schema) {
    bg = getBackgroundClass(schema);
}

// 获取夜间模式背景 ID 并设置相应类名
var bgElement = document.querySelector(webBackground);
if (bgElement) {
    bgElement.setAttribute('class',bg);
}
```

我实在不知道要怎样才能让一个控件的切换效果显得非常流畅，所以只好用了两个控件来做背景，通过设置前面一层背景为全透明来显示后面的背景，目前效果看起来还不错，只是每次都需要获取两张背景，有可能拖慢网站加载速度，不过我的两张背景加起来大小不到 1 MB，应该不会有太大影响吧......

---

后续更新如下：

我今天突然发现 `background-image` 也是支持 `transition` 的，因此就更新了一下代码......

```javascript
hexo.extend.injector.register("body_begin", `<div id="web-bg"></div></div>`);
```

```css
#web-bg {
    position: fixed;
    z-index: -999;
    width: 100%;
    height: 100%;
    background-attachment: fixed;
    background-position: center;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    background-size: cover;
    background-repeat: no-repeat;
    transition: background-image 0.3s ease-in; 
    -moz-transition: background-image 0.3s ease-in;
    -webkit-transition: background-image 0.3s ease-in;
}

.bg-dark {
    background-image: url("dark.jpg");
}

.bg-light {
    background-image: url("light.jpg");
}
```